<?php
use Symfony\Component\ClassLoader\ApcClassLoader;

/**
 * Registers namespaced generated by composer
 *
 * @throws RuntimeException if composer autoloading file cannot be found
 */
function classloader_composer_register() {
  static $registered = false;

  if (!$registered) {
    $autoload_file = DRUPAL_ROOT . '/../vendor/autoload.php';
    if (!file_exists($autoload_file)) {
      throw new \RuntimeException('Composer autoload file not found: ' . $autoload_file);
    }

    $loader = require_once $autoload_file;
    $loader->register();
    if (function_exists('apc_exists')) {
      $cachedLoader  = new ApcClassLoader('drupal', $loader);
      $cachedLoader->register();
      $loader->unregister();
    }

    $registered = true;
  }
}
